<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-terminal-4.7.4">
     
     
    <link rel="icon" type="image/png" sizes="192x192" href="../../../img/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="../../../img/android-chrome-512x512.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../../../img/apple-touch-icon.png" />
<link rel="shortcut icon" type="image/png" sizes="48x48" href="../../../img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="../../../img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../../../img/favicon-32x32.png" />


    
 
<title>workspaces - emacs.d</title>


<link href="../../../css/fontawesome/css/fontawesome.min.css" rel="stylesheet">
<link href="../../../css/fontawesome/css/solid.min.css" rel="stylesheet">
<link href="../../../css/normalize.css" rel="stylesheet">
<link href="../../../css/terminal.css" rel="stylesheet">
<link href="../../../css/theme.css" rel="stylesheet">
<link href="../../../css/theme.tile_grid.css" rel="stylesheet">
<link href="../../../css/theme.footer.css" rel="stylesheet">
<!-- gruvbox_dark color palette -->
<link href="../../../css/palettes/gruvbox_dark.css" rel="stylesheet">

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 3fr 9fr;
        <!-- grid-template-columns: 4fr 9fr; -->
    }
}</style>



     
    
    

    
    <!-- search css support -->
<link href="../../../css/search/bootstrap-modal.css" rel="stylesheet">
<!-- search scripts -->
<script>
    var base_url = "../../..",
    shortcuts = "{}";
</script>
<script src="../../../js/jquery/jquery-1.10.1.min.js" defer></script>
<script src="../../../js/bootstrap/bootstrap.min.js" defer></script>
<script src="../../../js/mkdocs/base.js" defer></script>
    
    
    
    
    <script src="../../../search/main.js"></script>
    

    
</head>

<body class="terminal"><div class="container">
    <div class="terminal-nav">
        <header class="terminal-logo">
            <div id="mkdocs-terminal-site-name" class="logo terminal-prompt"><a href="/" class="no-style">emacs.d</a></div>
        </header>
        
        <nav class="terminal-menu">
            
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../../.." class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Home</span>
                    </a>
                    <meta property="position" content="0">
                </li>
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../../../about/" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">About</span>
                    </a>
                    <meta property="position" content="1">
                </li>
                
                
                
                
                
                
                
                    
                    


<li property="itemListElement" typeof="ListItem">
    <a href="#" class="menu-item" data-toggle="modal" data-target="#mkdocs_search_modal" property="item" typeof="SearchAction">
        <i aria-hidden="true" class="fa fa-search"></i> <span property="name">Search</span>
    </a>
    <meta property="position" content="2">
</li>
                    
            </ul>
            
        </nav>
    </div>
</div>
        
    <div class="container">
        <div class="terminal-mkdocs-main-grid"><aside id="terminal-mkdocs-side-panel"><nav>
  
    <ul class="terminal-mkdocs-side-nav-items">
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../..">Home</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../../about/">About</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Init</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../early-init/">early-init</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../../init/">init</a>
        
    
    
                

                
                
            </li>
        
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        <span class="
        
    

    terminal-mkdocs-side-nav-item--active terminal-mkdocs-side-nav-section-no-index">Src</span>
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../_src/">src</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bbase/">base</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bkbd/">kbd</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bcompletion/">completion</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bide/">ide</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Borg/">org</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Blatex/">latex</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        <span class="

    terminal-mkdocs-side-nav-item--active">workspaces</span>
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bprograms/">programs</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bui/">ui</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bmisc/">misc</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bto-sort/">tosort</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../%2Bdocumentation/">documentation</a>
        
    
    
                

                
                
            </li>
        
    </ul>
        
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
        
        

        
            
    
        
        
            
            
            <span class="
        
    

    terminal-mkdocs-side-nav-item terminal-mkdocs-side-nav-section-no-index">Misc</span>
        
    
    
        
      
        
            <ul class="terminal-mkdocs-side-nav-li-ul">
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../misc/%2Blog/">log</a>
        
    
    
                

                
                
            </li>
        
            
            

            <li class="terminal-mkdocs-side-nav-li-ul-li">
                
                    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../misc/%2Btools/">tools</a>
        
    
    
                

                
                
            </li>
        
    </ul>
        
    
  </li>
        
    </ul>
  
</nav><hr>
<nav>
    <ul>
        <li><a href="#persp-mode">% Persp-mode</a></li>
        <li><a href="#perspective">% Perspective</a></li>
        
    </ul>
</nav>
</aside>
            <main id="terminal-mkdocs-main-content">
    
    
    
    
    

<section id="mkdocs-terminal-content">
    <p>maybe have each persp have its own save file, and when autosaving, save each persp?
maybe have a function to delete a persp from the main autosave file?
- prompt available perspectives from main autosave file, after selection,
delete each from file.</p>
<p>Activities</p>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">  </span><span style="color: #FFD173">:custom</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; only show tab bar if more than 3 activities open</span>
<span style="color: #D4D2C8">  (tab-bar-show </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">3</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:init</span>
<span style="color: #D4D2C8">  (activities-mode)</span>
<span style="color: #D4D2C8">  (activities-tabs-mode)</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; prevent edebug default bindings from interfering</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; (setq edebug-inhibit-emacs-lisp-mode-bindings t)</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; create map</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">defun</span><span style="color: #D4D2C8"> +activities-define-existing ()</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">interactive</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((current-prefix-arg </span><span style="color: #FFAD66">&#39;</span><span style="color: #D4D2C8">(</span><span style="color: #DFBFFF">4</span><span style="color: #D4D2C8">)))</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">call-interactively</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">activities-define)))</span>

<span style="color: #D4D2C8">  (</span><span style="color: #FFAD66">defvar</span><span style="color: #D4D2C8"> activities-mode-map</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((map (</span><span style="color: #FFD173">make-sparse-keymap</span><span style="color: #D4D2C8">)))</span>
<span style="color: #D4D2C8">      </span><span style="color: #7E8AA1">;; Define keys in bulk</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">dolist</span>
<span style="color: #D4D2C8">          (binding</span>
<span style="color: #D4D2C8">           </span><span style="color: #FFAD66">&#39;</span><span style="color: #D4D2C8">(</span><span style="color: #7E8AA1">;; create new activity name.</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;N&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> activities-new)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; define new activity&#39;s default with current frame state.</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; (prefix) define pre-existing activity&#39; default with current frame state.</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;d&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> +activities-define-existing)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; resume suspended activity</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; (prefix) resume activity with default state.</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;.&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> +activities-resume-custom)</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;s&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> +activities-resume-custom)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; save and close activity.</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; (&quot;k&quot; . activities-suspend)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; reset to default state and close activity.</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;c&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> activities-kill)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; switch to an opened activity</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; (&quot;s&quot; . activities-switch)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; permanently delete activity</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;k&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> activities-discard)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; switch to a buffer in the current activity.</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;b&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> activities-switch-buffer)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; revert activity to default state.</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;g&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> activities-revert)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; list activities in vtable buffer</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;l&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> activities-list)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; rename activity</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;R&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> activities-rename)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; next tab</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;n&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> tab-next)</span>
<span style="color: #D4D2C8">             </span><span style="color: #7E8AA1">;; previous tab</span>
<span style="color: #D4D2C8">             (</span><span style="color: #D5FF80">&quot;p&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> tab-previous)))</span>
<span style="color: #D4D2C8">        (</span><span style="color: #FFD173">define-key</span><span style="color: #D4D2C8"> map (kbd (</span><span style="color: #FFD173">car</span><span style="color: #D4D2C8"> binding)) (</span><span style="color: #FFD173">cdr</span><span style="color: #D4D2C8"> binding)))</span>
<span style="color: #D4D2C8">      </span><span style="color: #7E8AA1">;; set up autoloads</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((cmds (</span><span style="color: #FFD173">mapcar</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;cdr</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">cdr</span><span style="color: #D4D2C8"> map))))</span>
<span style="color: #D4D2C8">        (</span><span style="color: #FFD173">dolist</span><span style="color: #D4D2C8"> (c cmds)</span>
<span style="color: #D4D2C8">          (</span><span style="color: #FFD173">unless</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">fboundp</span><span style="color: #D4D2C8"> c)</span>
<span style="color: #D4D2C8">            (</span><span style="color: #FFD173">autoload</span><span style="color: #D4D2C8"> c </span><span style="color: #D5FF80">&quot;activities&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8">))))</span>
<span style="color: #D4D2C8">      </span><span style="color: #7E8AA1">;; return map</span>
<span style="color: #D4D2C8">      map))</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; bind map</span>
<span style="color: #D4D2C8">  (global-set-key (kbd </span><span style="color: #D5FF80">&quot;C-c .&quot;</span><span style="color: #D4D2C8">) activities-mode-map)</span>
<span style="color: #D4D2C8">  (global-set-key (kbd </span><span style="color: #D5FF80">&quot;C-c x&quot;</span><span style="color: #D4D2C8">) activities-mode-map)</span>
</code></pre></div>
<h4 id="consult-integration">&gt; consult integration</h4>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">  (</span><span style="color: #FFD173">defun</span><span style="color: #D4D2C8"> activities-local-buffer-p (buffer)</span>
<span style="color: #D4D2C8">    </span><span style="color: #D5FF80">&quot;Returns non-nil if BUFFER is present in </span><span style="color: #DFBFFF">`activities-current&#39;</span><span style="color: #D5FF80">.&quot;</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> (activities-current)</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">memq</span><span style="color: #D4D2C8"> buffer</span>
<span style="color: #D4D2C8">            (activities-tabs--tab-parameter</span>
<span style="color: #D4D2C8">             </span><span style="color: #DFBFFF">&#39;activities-buffer-list</span>
<span style="color: #D4D2C8">             (activities-tabs--tab (activities-current))))))</span>

<span style="color: #D4D2C8">  (</span><span style="color: #FFAD66">defvar</span><span style="color: #D4D2C8"> activities-consult-source</span>
<span style="color: #D4D2C8">    </span><span style="color: #FFAD66">`</span><span style="color: #D4D2C8">(</span><span style="color: #FFD173">:name</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;Activity&quot;</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:narrow</span><span style="color: #D4D2C8">   </span><span style="color: #D5FF80">?a</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:category</span><span style="color: #D4D2C8"> buffer</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:face</span><span style="color: #D4D2C8">     consult-buffer</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:history</span><span style="color: #D4D2C8">  buffer-name-history</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:state</span><span style="color: #D4D2C8">    </span><span style="color: #FFAD66">,</span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">consult--buffer-state</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:default</span><span style="color: #D4D2C8">  </span><span style="color: #FFD173">t</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:enabled</span><span style="color: #D4D2C8">  </span><span style="color: #FFAD66">,</span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">activities-current</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:items</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">,</span><span style="color: #D4D2C8">(</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> () (consult--buffer-query</span>
<span style="color: #D4D2C8">                           </span><span style="color: #FFD173">:predicate</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">activities-local-buffer-p</span>
<span style="color: #D4D2C8">                           </span><span style="color: #FFD173">:sort</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;visibility</span>
<span style="color: #D4D2C8">                           </span><span style="color: #FFD173">:as</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;buffer-name</span><span style="color: #D4D2C8">)))</span>
<span style="color: #D4D2C8">    </span><span style="color: #D5FF80">&quot;Activities local buffers candidate source for </span><span style="color: #DFBFFF">`consult-buffer&#39;</span><span style="color: #D5FF80">.&quot;</span><span style="color: #D4D2C8">)</span>

<span style="color: #D4D2C8">  (</span><span style="color: #FFAD66">defvar</span><span style="color: #D4D2C8"> activities-rest-consult-source</span>
<span style="color: #D4D2C8">    </span><span style="color: #FFAD66">`</span><span style="color: #D4D2C8">(</span><span style="color: #FFD173">:name</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;Rest&quot;</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:narrow</span><span style="color: #D4D2C8">   </span><span style="color: #D5FF80">?r</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:category</span><span style="color: #D4D2C8"> buffer</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:face</span><span style="color: #D4D2C8">     consult-buffer</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:history</span><span style="color: #D4D2C8">  buffer-name-history</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:state</span><span style="color: #D4D2C8">    </span><span style="color: #FFAD66">,</span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">consult--buffer-state</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:enabled</span><span style="color: #D4D2C8">  </span><span style="color: #FFAD66">,</span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">activities-current</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:items</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">,</span><span style="color: #D4D2C8">(</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> () (consult--buffer-query</span>
<span style="color: #D4D2C8">                           </span><span style="color: #FFD173">:predicate</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (buf)</span>
<span style="color: #D4D2C8">                                        (not (activities-local-buffer-p buf)))</span>
<span style="color: #D4D2C8">                           </span><span style="color: #FFD173">:as</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;buffer-name</span><span style="color: #D4D2C8">)))</span>
<span style="color: #D4D2C8">    </span><span style="color: #D5FF80">&quot;Other buffers candidate source for </span><span style="color: #DFBFFF">`consult-buffer&#39;</span><span style="color: #D5FF80">.&quot;</span><span style="color: #D4D2C8">)</span>

<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">with-eval-after-load</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;consult</span>
<span style="color: #D4D2C8">    (consult-customize consult--source-buffer </span><span style="color: #FFD173">:hidden</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:default</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span>
<span style="color: #D4D2C8">                       </span><span style="color: #FFD173">:name</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;Buffers&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:narrow</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">?b</span>
<span style="color: #D4D2C8">                       </span><span style="color: #FFD173">:enabled</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> () (not (activities-current))))</span>
<span style="color: #D4D2C8">    (add-to-list </span><span style="color: #DFBFFF">&#39;consult-buffer-sources</span><span style="color: #D4D2C8"> activities-rest-consult-source)</span>
<span style="color: #D4D2C8">    (add-to-list </span><span style="color: #DFBFFF">&#39;consult-buffer-sources</span><span style="color: #D4D2C8"> activities-consult-source))</span>
</code></pre></div>
<h5 id="exclude-consult-buffer-previews-from-activity-buffer-list">‣ exclude consult-buffer previews from activity-buffer-list</h5>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">  (</span><span style="color: #FFD173">with-eval-after-load</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;consult</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFD173">defun</span><span style="color: #D4D2C8"> +consult-buffer--frame-buffers-around (orig-fn </span><span style="color: #FFAD66">&amp;rest</span><span style="color: #D4D2C8"> args)</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((_log </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">            (result </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">        (if-let* ((_predicates (</span><span style="color: #FFAD66">and</span><span style="color: #D4D2C8"> activities-mode</span>
<span style="color: #D4D2C8">                                    activities-tabs-mode</span>
<span style="color: #D4D2C8">                                    tab-bar-mode</span>
<span style="color: #D4D2C8">                                    (activities-current)))</span>
<span style="color: #D4D2C8">                  (current-tab (tab-bar--current-tab))</span>
<span style="color: #D4D2C8">                  (tab-index (tab-bar--current-tab-index))</span>
<span style="color: #D4D2C8">                  (init-tab-buffers (alist-get </span><span style="color: #DFBFFF">&#39;activities-buffer-list</span><span style="color: #D4D2C8"> current-tab)))</span>
<span style="color: #D4D2C8">            </span><span style="color: #7E8AA1">;; if-let then form</span>
<span style="color: #D4D2C8">            (</span><span style="color: #FFAD66">unwind-protect</span>
<span style="color: #D4D2C8">                (</span><span style="color: #FFAD66">setq</span><span style="color: #D4D2C8"> result (</span><span style="color: #FFD173">apply</span><span style="color: #D4D2C8"> orig-fn args))</span>
<span style="color: #D4D2C8">              </span><span style="color: #7E8AA1">;; re-fetch current tab after consult-buffer</span>
<span style="color: #D4D2C8">              (</span><span style="color: #FFAD66">let*</span><span style="color: #D4D2C8"> ((updated-tab (tab-bar--current-tab))</span>
<span style="color: #D4D2C8">                     (post-tab-buffers</span>
<span style="color: #D4D2C8">                      (seq-filter </span><span style="color: #FFD173">#&#39;buffer-live-p</span>
<span style="color: #D4D2C8">                                  (alist-get </span><span style="color: #DFBFFF">&#39;activities-buffer-list</span><span style="color: #D4D2C8"> updated-tab)))</span>
<span style="color: #D4D2C8">                     (</span><span style="color: #FFD173">current-buffer</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">current-buffer</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">                     </span><span style="color: #7E8AA1">;; remove new temp buffers from post-tab-buffers</span>
<span style="color: #D4D2C8">                     (filtered-new</span>
<span style="color: #D4D2C8">                      (seq-filter (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (buf)</span>
<span style="color: #D4D2C8">                                    (</span><span style="color: #FFAD66">and</span><span style="color: #D4D2C8"> buf</span>
<span style="color: #D4D2C8">                                         (</span><span style="color: #FFAD66">or</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">member</span><span style="color: #D4D2C8"> buf init-tab-buffers)</span>
<span style="color: #D4D2C8">                                             (</span><span style="color: #FFD173">eq</span><span style="color: #D4D2C8"> buf </span><span style="color: #FFD173">current-buffer</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">                                             (</span><span style="color: #FFD173">equal</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">buffer-name</span><span style="color: #D4D2C8"> buf)</span>
<span style="color: #D4D2C8">                                                    </span><span style="color: #D5FF80">&quot; *Minibuf-1*&quot;</span><span style="color: #D4D2C8">))))</span>
<span style="color: #D4D2C8">                                  post-tab-buffers)))</span>
<span style="color: #D4D2C8">                </span><span style="color: #7E8AA1">;; debugging</span>
<span style="color: #D4D2C8">                (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> _log</span>
<span style="color: #D4D2C8">                  (</span><span style="color: #FFD173">message</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;LOG: activities: ignore consult-buffer previews: %S&quot;</span>
<span style="color: #D4D2C8">                           (</span><span style="color: #FFD173">mapcar</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;buffer-name</span>
<span style="color: #D4D2C8">                                   (seq-remove (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (x) (</span><span style="color: #FFD173">member</span><span style="color: #D4D2C8"> x filtered-new))</span>
<span style="color: #D4D2C8">                                               post-tab-buffers))))</span>
<span style="color: #D4D2C8">                </span><span style="color: #7E8AA1">;; update the tab&#39;s activities-buffer-list</span>
<span style="color: #D4D2C8">                (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((tabs (</span><span style="color: #FFD173">funcall</span><span style="color: #D4D2C8"> tab-bar-tabs-function)))</span>
<span style="color: #D4D2C8">                  (</span><span style="color: #FFD173">setf</span><span style="color: #D4D2C8"> (alist-get </span><span style="color: #DFBFFF">&#39;activities-buffer-list</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">nth</span><span style="color: #D4D2C8"> tab-index tabs))</span>
<span style="color: #D4D2C8">                        filtered-new))</span>

<span style="color: #D4D2C8">                result))</span>
<span style="color: #D4D2C8">          </span><span style="color: #7E8AA1">;; if-let else form</span>
<span style="color: #D4D2C8">          (</span><span style="color: #FFD173">apply</span><span style="color: #D4D2C8"> orig-fn args))))</span>

<span style="color: #D4D2C8">    (advice-add </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">consult-buffer </span><span style="color: #FFD173">:around</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">+consult-buffer--frame-buffers-around))</span>
</code></pre></div>
<h5 id="frame-delete-n-restore-disabled">‣ Frame delete n restore (disabled)</h5>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; ;; helper variable</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; (defvar +activities--last-name nil)</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; ;; save activities before deleting frame</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; (add-to-list &#39;delete-frame-functions</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;;              (lambda (frame)</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;;                (setq +activities--last-name (activities-current))</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;;                (activities-save-all)))</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; ;; save activities before killing emacs</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; (add-hook &#39;kill-emacs-hook #&#39;activities-save-all)</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; ;; resume last activity when creating frame</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; (add-hook &#39;after-make-frame-functions</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;;           (lambda (frame)</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;;             (when +activities--last-name</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;;               (with-selected-frame frame</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;;                 (activities-resume +activities--last-name)))))</span>
</code></pre></div>
<h5 id="smart-resuming-exclude-running-in-frames-suspend-all-other">‣ smart resuming (exclude running in frames, suspend all other)</h5>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; TODO: show this to https://github.com/alphapapa/activities.el/issues/22</span>

<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">cl-defun</span><span style="color: #D4D2C8"> +activities-resume-custom (activity </span><span style="color: #FFAD66">&amp;key</span><span style="color: #D4D2C8"> resetp)</span>
<span style="color: #D4D2C8">    </span><span style="color: #D5FF80">&quot;Wrapper around </span><span style="color: #DFBFFF">`activities-resume&#39;</span><span style="color: #D5FF80">.</span>

<span style="color: #D5FF80">When prompted, it excludes activities that are active in other frames.</span>
<span style="color: #D5FF80">After evaluating, it suspends all non-current activities.&quot;</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">interactive</span>
<span style="color: #D4D2C8">     (</span><span style="color: #FFD173">list</span><span style="color: #D4D2C8"> (activities-completing-read</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:activities</span><span style="color: #D4D2C8"> (+activities--exclude-other-frames)</span>
<span style="color: #D4D2C8">            </span><span style="color: #FFD173">:prompt</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;Resume activity&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:default</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">           </span><span style="color: #FFD173">:resetp</span><span style="color: #D4D2C8"> current-prefix-arg))</span>
<span style="color: #D4D2C8">    (activities-suspend (activities-current))</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((result (</span><span style="color: #FFD173">apply</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">activities-resume</span>
<span style="color: #D4D2C8">                         activity</span>
<span style="color: #D4D2C8">                         (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> resetp (</span><span style="color: #FFD173">list</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:resetp</span><span style="color: #D4D2C8"> resetp)))))</span>
<span style="color: #D4D2C8">      </span><span style="color: #7E8AA1">;; after apply</span>
<span style="color: #D4D2C8">      (+activities--suspend-not-cur)</span>
<span style="color: #D4D2C8">      result))</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; helper function</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">defun</span><span style="color: #D4D2C8"> +activities--exclude-other-frames ()</span>
<span style="color: #D4D2C8">    </span><span style="color: #D5FF80">&quot;Return loadable activities, excluding already active in other frames.&quot;</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> (</span><span style="color: #7E8AA1">;; activities loadable from file</span>
<span style="color: #D4D2C8">          (activities-loadable (-map </span><span style="color: #FFD173">#&#39;car-safe</span><span style="color: #D4D2C8"> activities-activities))</span>
<span style="color: #D4D2C8">          </span><span style="color: #7E8AA1">;; activities active in any frame except current</span>
<span style="color: #D4D2C8">          (activities-active-in-other</span>
<span style="color: #D4D2C8">           (-&gt;&gt;</span>
<span style="color: #D4D2C8">            (</span><span style="color: #FFD173">frame-list</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">            (--remove (</span><span style="color: #FFD173">equal</span><span style="color: #D4D2C8"> it (</span><span style="color: #FFD173">selected-frame</span><span style="color: #D4D2C8">)))</span>
<span style="color: #D4D2C8">            (-mapcat</span>
<span style="color: #D4D2C8">             (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (frame)</span>
<span style="color: #D4D2C8">               (</span><span style="color: #FFD173">with-selected-frame</span><span style="color: #D4D2C8"> frame</span>
<span style="color: #D4D2C8">                 (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((active-names</span>
<span style="color: #D4D2C8">                        (-&gt;&gt;</span>
<span style="color: #D4D2C8">                         activities-activities</span>
<span style="color: #D4D2C8">                         (-filter (-compose </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">activities-activity-active-p</span>
<span style="color: #D4D2C8">                                            </span><span style="color: #FFD173">#&#39;cdr</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">                         (-map </span><span style="color: #FFD173">#&#39;car-safe</span><span style="color: #D4D2C8">))))</span>
<span style="color: #D4D2C8">                   (</span><span style="color: #FFAD66">prog1</span><span style="color: #D4D2C8"> active-names</span>
<span style="color: #D4D2C8">                     (</span><span style="color: #FFD173">message</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;LOG: active-names: %S&quot;</span><span style="color: #D4D2C8"> active-names)</span>
<span style="color: #D4D2C8">                     (</span><span style="color: #FFD173">unless</span><span style="color: #D4D2C8"> (</span><span style="color: #FFAD66">or</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">&lt;=</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">1</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">length</span><span style="color: #D4D2C8"> active-names))</span>
<span style="color: #D4D2C8">                                 (not active-names))</span>
<span style="color: #D4D2C8">                       (</span><span style="color: #73D0FF">warn</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;Expected no more than 1 activity in frame %s: %s&quot;</span>
<span style="color: #D4D2C8">                             frame active-names)))))))</span>
<span style="color: #D4D2C8">            (-non-nil)</span>
<span style="color: #D4D2C8">            (-uniq))))</span>
<span style="color: #D4D2C8">      </span><span style="color: #7E8AA1">;; from loadable, remove active-in-other</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">message</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;LOG: activities-loadable: %S&quot;</span><span style="color: #D4D2C8"> activities-loadable)</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">message</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;LOG: activities-active-in-other: %S&quot;</span><span style="color: #D4D2C8"> activities-active-in-other)</span>
<span style="color: #D4D2C8">      (-&gt;&gt; activities-loadable</span>
<span style="color: #D4D2C8">           (--remove (-contains? activities-active-in-other</span>
<span style="color: #D4D2C8">                                 it))</span>
<span style="color: #D4D2C8">           (--map (</span><span style="color: #FFD173">cons</span><span style="color: #D4D2C8"> it (activities-named it))))))</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; helper function</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">cl-defun</span><span style="color: #D4D2C8"> +activities--suspend-not-cur (</span><span style="color: #FFAD66">&amp;rest</span><span style="color: #D4D2C8"> _args)</span>
<span style="color: #D4D2C8">    </span><span style="color: #D5FF80">&quot;Suspend all non-current activities.&quot;</span>
<span style="color: #D4D2C8">    (when-let*</span>
<span style="color: #D4D2C8">        ((fn-get-active-lst</span>
<span style="color: #D4D2C8">          (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> () (-&gt;&gt; activities-activities</span>
<span style="color: #D4D2C8">                     (-filter (-compose </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">activities-activity-active-p </span><span style="color: #FFD173">#&#39;cdr</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">                     (-map </span><span style="color: #FFD173">#&#39;car-safe</span><span style="color: #D4D2C8">))))</span>
<span style="color: #D4D2C8">         (active-lst (</span><span style="color: #FFD173">funcall</span><span style="color: #D4D2C8"> fn-get-active-lst))</span>
<span style="color: #D4D2C8">         (current (activities-activity-name (activities-current)))</span>
<span style="color: #D4D2C8">         (not-current-lst</span>
<span style="color: #D4D2C8">          (-&gt;&gt; active-lst (--remove (</span><span style="color: #FFD173">equal</span><span style="color: #D4D2C8"> current it)))))</span>
<span style="color: #D4D2C8">      </span><span style="color: #7E8AA1">;; suspend all non-current activities</span>
<span style="color: #D4D2C8">      (--each not-current-lst</span>
<span style="color: #D4D2C8">        (activities-suspend (activities-named it)))</span>
<span style="color: #D4D2C8">      </span><span style="color: #7E8AA1">;; assert expected length and current-value</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFAD66">setq</span><span style="color: #D4D2C8"> active-lst (</span><span style="color: #FFD173">funcall</span><span style="color: #D4D2C8"> fn-get-active-lst))</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">unless</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">&lt;=</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">1</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">length</span><span style="color: #D4D2C8"> active-lst))</span>
<span style="color: #D4D2C8">        (</span><span style="color: #73D0FF">warn</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;expected 1 or 0 length for active-lst: %s&quot;</span>
<span style="color: #D4D2C8">              active-lst)</span>
<span style="color: #D4D2C8">        (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> (</span><span style="color: #FFAD66">and</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">=</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">1</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">length</span><span style="color: #D4D2C8"> active-lst))</span>
<span style="color: #D4D2C8">                   (</span><span style="color: #FFD173">equal</span><span style="color: #D4D2C8"> current (</span><span style="color: #FFD173">car</span><span style="color: #D4D2C8"> active-lst)))</span>
<span style="color: #D4D2C8">          (</span><span style="color: #73D0FF">warn</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;expected 1 elem of %s, got %S&quot;</span>
<span style="color: #D4D2C8">                current (</span><span style="color: #FFD173">car</span><span style="color: #D4D2C8"> active-lst))))))</span>
</code></pre></div>
<h5 id="misc">‣ misc</h5>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">  )</span>
</code></pre></div>
<h3 id="persp-mode">% Persp-mode</h3>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">(leaf persp-mode </span><span style="color: #FFD173">:disabled</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:bind-keymap</span>
<span style="color: #D4D2C8">  (</span><span style="color: #D5FF80">&quot;C-c w w&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> persp-key-map)</span>
<span style="color: #D4D2C8">  (</span><span style="color: #D5FF80">&quot;C-c .&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> persp-key-map)</span>
<span style="color: #D4D2C8">  (</span><span style="color: #D5FF80">&quot;C-c (&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> persp-key-map)</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:bind</span><span style="color: #D4D2C8"> (persp-key-map</span>
<span style="color: #D4D2C8">         (</span><span style="color: #D5FF80">&quot;.&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> my-persp-load-name-from-latest)</span>
<span style="color: #D4D2C8">         (</span><span style="color: #D5FF80">&quot;D&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> my-persp-delete-name-from-latest))</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:setq</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; animation</span>
<span style="color: #D4D2C8">  (wg-morph-on </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; ?</span>
<span style="color: #D4D2C8">  (persp-autokill-buffer-on-remove </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;kill-weak</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; dont autoresume at startup</span>
<span style="color: #D4D2C8">  (persp-auto-resume-time </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">-1</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; save on shutdown</span>
<span style="color: #D4D2C8">  (persp-auto-save-opt </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">2</span><span style="color: #D4D2C8">)</span>

<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:hook</span>
<span style="color: #D4D2C8">  (elpaca-after-init-hook </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> () (persp-mode </span><span style="color: #DFBFFF">1</span><span style="color: #D4D2C8">)))</span>

<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:commands</span>
<span style="color: #D4D2C8">  persp-consult-source</span>

<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:config</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; dont save persp-nil to file</span>
<span style="color: #D4D2C8">  (set-persp-parameter </span><span style="color: #DFBFFF">&#39;dont-save-to-file</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; consult-buffer integration</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFAD66">defvar</span><span style="color: #D4D2C8"> persp-consult-source</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFD173">list</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:name</span><span style="color: #D4D2C8">     </span><span style="color: #D5FF80">&quot;Persp Buffers&quot;</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:narrow</span><span style="color: #D4D2C8">   </span><span style="color: #D5FF80">?.</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:category</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;buffer</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:state</span><span style="color: #D4D2C8">    </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">consult--buffer-state</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:history</span><span style="color: #D4D2C8">  </span><span style="color: #DFBFFF">&#39;buffer-name-history</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:default</span><span style="color: #D4D2C8">  </span><span style="color: #FFD173">t</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:items</span>
<span style="color: #D4D2C8">          (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> ()</span>
<span style="color: #D4D2C8">            (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((current-persp (get-current-persp)))</span>
<span style="color: #D4D2C8">              (consult--buffer-query</span>
<span style="color: #D4D2C8">               </span><span style="color: #FFD173">:sort</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;visibility</span>
<span style="color: #D4D2C8">               </span><span style="color: #FFD173">:predicate</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (buf)</span>
<span style="color: #D4D2C8">                            (</span><span style="color: #FFAD66">and</span><span style="color: #D4D2C8"> current-persp</span>
<span style="color: #D4D2C8">                                 (persp-contain-buffer-p buf)))</span>
<span style="color: #D4D2C8">               </span><span style="color: #FFD173">:as</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;buffer-name</span><span style="color: #D4D2C8">)))))</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFAD66">defvar</span><span style="color: #D4D2C8"> persp-rest-consult-source</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFD173">list</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:name</span><span style="color: #D4D2C8">     </span><span style="color: #D5FF80">&quot;Other Buffers&quot;</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:narrow</span><span style="color: #D4D2C8">   </span><span style="color: #D5FF80">?s</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:category</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;buffer</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:state</span><span style="color: #D4D2C8">    </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">consult--buffer-state</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:history</span><span style="color: #D4D2C8">  </span><span style="color: #DFBFFF">&#39;buffer-name-history</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:default</span><span style="color: #D4D2C8">  </span><span style="color: #FFD173">t</span>
<span style="color: #D4D2C8">          </span><span style="color: #FFD173">:items</span>
<span style="color: #D4D2C8">          (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> ()</span>
<span style="color: #D4D2C8">            (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((current-persp (get-current-persp)))</span>
<span style="color: #D4D2C8">              (consult--buffer-query</span>
<span style="color: #D4D2C8">               </span><span style="color: #FFD173">:sort</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;visibility</span>
<span style="color: #D4D2C8">               </span><span style="color: #FFD173">:predicate</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (buf)</span>
<span style="color: #D4D2C8">                            (</span><span style="color: #FFAD66">if</span><span style="color: #D4D2C8"> current-persp</span>
<span style="color: #D4D2C8">                                (not (persp-contain-buffer-p buf))</span>
<span style="color: #D4D2C8">                              </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">               </span><span style="color: #FFD173">:as</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;buffer-name</span><span style="color: #D4D2C8">)))))</span>

<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">with-eval-after-load</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;consult</span>
<span style="color: #D4D2C8">    (consult-customize consult--source-buffer </span><span style="color: #FFD173">:hidden</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:default</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">    (add-to-list </span><span style="color: #DFBFFF">&#39;consult-buffer-sources</span><span style="color: #D4D2C8"> persp-rest-consult-source)</span>
<span style="color: #D4D2C8">    (add-to-list </span><span style="color: #DFBFFF">&#39;consult-buffer-sources</span><span style="color: #D4D2C8"> persp-consult-source))</span>


<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; helper functions</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">defun</span><span style="color: #D4D2C8"> my/persp--get-names-from-savelist (</span><span style="color: #FFAD66">&amp;optional</span><span style="color: #D4D2C8"> fname savelist)</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">let*</span><span style="color: #D4D2C8"> ((available (persp-list-persp-names-in-file fname savelist))</span>
<span style="color: #D4D2C8">           (loaded (persp-names-current-frame-fast-ordered))</span>
<span style="color: #D4D2C8">           (unloaded (seq-remove (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (p) (</span><span style="color: #FFD173">member</span><span style="color: #D4D2C8"> p loaded)) available)))</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">list</span><span style="color: #D4D2C8"> available loaded unloaded)))</span>

<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">defun</span><span style="color: #D4D2C8"> my/persp--prompt-for-persp-name (lst)</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> lst</span>
<span style="color: #D4D2C8">      (persp-read-persp</span>
<span style="color: #D4D2C8">       </span><span style="color: #D5FF80">&quot;to load&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> lst </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;push</span><span style="color: #D4D2C8">)))</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; TODO: relocate</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">defmacro</span><span style="color: #D4D2C8"> +message-if-debug (format-string </span><span style="color: #FFAD66">&amp;rest</span><span style="color: #D4D2C8"> args)</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> debug-on-error</span>
<span style="color: #D4D2C8">      </span><span style="color: #FFAD66">`</span><span style="color: #D4D2C8">(</span><span style="color: #FFD173">message</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">,</span><span style="color: #D4D2C8">format-string </span><span style="color: #FFAD66">,@</span><span style="color: #D4D2C8">args)))</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; load from file</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">cl-defun</span><span style="color: #D4D2C8"> my-persp-load-name-from-latest</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFAD66">&amp;optional</span><span style="color: #D4D2C8"> (fname persp-auto-save-fname)</span>
<span style="color: #D4D2C8">                 (phash *persp-hash*)</span>
<span style="color: #D4D2C8">                 (savelist (persp-savelist-from-savefile fname))</span>
<span style="color: #D4D2C8">                 name)</span>
<span style="color: #D4D2C8">    </span><span style="color: #D5FF80">&quot;Load and switch to a perspective via name from the latest backup file.&quot;</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">interactive</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">    </span><span style="color: #7E8AA1">;; prompt for name from available</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> savelist</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFD173">cl-destructuring-bind</span><span style="color: #D4D2C8"> (available loaded unloaded)</span>
<span style="color: #D4D2C8">          (my/persp--get-names-from-savelist fname savelist)</span>
<span style="color: #D4D2C8">        (</span><span style="color: #FFD173">when</span><span style="color: #D4D2C8"> unloaded</span>
<span style="color: #D4D2C8">          (</span><span style="color: #FFD173">unless</span><span style="color: #D4D2C8"> name</span>
<span style="color: #D4D2C8">            (</span><span style="color: #FFAD66">setq</span><span style="color: #D4D2C8"> name (my/persp--prompt-for-persp-name unloaded)))</span>
<span style="color: #D4D2C8">          (+message-if-debug </span><span style="color: #D5FF80">&quot;DEBUG: &gt; %s\n&gt; %s\n&gt; %s\n&gt; %s&quot;</span>
<span style="color: #D4D2C8">                             fname</span>
<span style="color: #D4D2C8">                             phash</span>
<span style="color: #D4D2C8">                             (regexp-opt (</span><span style="color: #FFD173">list</span><span style="color: #D4D2C8"> name))</span>
<span style="color: #D4D2C8">                             savelist)</span>
<span style="color: #D4D2C8">          (persp-load-state-from-file fname phash</span>
<span style="color: #D4D2C8">                                      (regexp-opt (</span><span style="color: #FFD173">list</span><span style="color: #D4D2C8"> name))</span>
<span style="color: #D4D2C8">                                      </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> savelist)</span>
<span style="color: #D4D2C8">          </span><span style="color: #7E8AA1">;; (persp-frame-switch name)</span>
<span style="color: #D4D2C8">          )))</span>

<span style="color: #D4D2C8">    </span><span style="color: #7E8AA1">;; (when name</span>
<span style="color: #D4D2C8">    </span><span style="color: #7E8AA1">;;   (let ((names-regexp (regexp-opt (list name))))</span>
<span style="color: #D4D2C8">    </span><span style="color: #7E8AA1">;;     (persp-load-state-from-file fname phash names-regexp t savelist))</span>
<span style="color: #D4D2C8">    </span><span style="color: #7E8AA1">;;   ;; switch to new loaded persp</span>
<span style="color: #D4D2C8">    </span><span style="color: #7E8AA1">;;   (persp-frame-switch name))</span>
<span style="color: #D4D2C8">    )</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; don&#39;t overwrite backup file with current; merge.</span>
<span style="color: #D4D2C8">  (advice-add </span><span style="color: #DFBFFF">&#39;persp-save-state-to-file</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:around</span>
<span style="color: #D4D2C8">              (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (orig-fun </span><span style="color: #FFAD66">&amp;rest</span><span style="color: #D4D2C8"> args)</span>
<span style="color: #D4D2C8">                </span><span style="color: #7E8AA1">;; We need to modify the fourth optional parameter</span>
<span style="color: #D4D2C8">                </span><span style="color: #7E8AA1">;; Default arguments structure:</span>
<span style="color: #D4D2C8">                </span><span style="color: #7E8AA1">;; (fname phash respect-persp-file-parameter keep-others-in-non-parametric-file)</span>
<span style="color: #D4D2C8">                (</span><span style="color: #FFAD66">let</span><span style="color: #D4D2C8"> ((fname (</span><span style="color: #FFAD66">or</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">nth</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">0</span><span style="color: #D4D2C8"> args) persp-auto-save-fname))</span>
<span style="color: #D4D2C8">                      (phash (</span><span style="color: #FFAD66">or</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">nth</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">1</span><span style="color: #D4D2C8"> args) *persp-hash*))</span>
<span style="color: #D4D2C8">                      (respect-param (</span><span style="color: #FFAD66">or</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">nth</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">2</span><span style="color: #D4D2C8"> args) persp-auto-save-persps-to-their-file))</span>
<span style="color: #D4D2C8">                      </span><span style="color: #7E8AA1">;; Always set the fourth parameter to &#39;yes regardless of what was passed</span>
<span style="color: #D4D2C8">                      (keep-others </span><span style="color: #DFBFFF">&#39;yes</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">                  </span><span style="color: #7E8AA1">;; Call the original function with modified arguments</span>
<span style="color: #D4D2C8">                  (</span><span style="color: #FFD173">funcall</span><span style="color: #D4D2C8"> orig-fun fname phash respect-param keep-others))))</span>


<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; delete persp from file</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">defun</span><span style="color: #D4D2C8"> my-persp-delete-name-from-latest ()</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">interactive</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">    (</span><span style="color: #FFAD66">let*</span><span style="color: #D4D2C8"> ((fname persp-auto-save-fname)</span>
<span style="color: #D4D2C8">           (savelist (persp-savelist-from-savefile fname))</span>
<span style="color: #D4D2C8">           (available-names (persp-list-persp-names-in-file fname savelist))</span>
<span style="color: #D4D2C8">           (names (persp-read-persp</span>
<span style="color: #D4D2C8">                   </span><span style="color: #D5FF80">&quot;to delete&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;reverse</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> available-names </span><span style="color: #FFD173">t</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;push</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">           (filtered-savelist (cl-remove-if</span>
<span style="color: #D4D2C8">                               (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (expr)</span>
<span style="color: #D4D2C8">                                 (</span><span style="color: #FFAD66">and</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">listp</span><span style="color: #D4D2C8"> expr)</span>
<span style="color: #D4D2C8">                                      (</span><span style="color: #FFD173">eq</span><span style="color: #D4D2C8"> (</span><span style="color: #FFD173">car</span><span style="color: #D4D2C8"> expr) </span><span style="color: #DFBFFF">&#39;def-persp</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">                                      (seq-contains-p names (cadr expr))))</span>
<span style="color: #D4D2C8">                               savelist)))</span>
<span style="color: #D4D2C8">      (</span><span style="color: #FFAD66">if</span><span style="color: #D4D2C8"> (y-or-n-p (</span><span style="color: #FFD173">format</span><span style="color: #D4D2C8"> </span><span style="color: #D5FF80">&quot;Delete %s?&quot;</span><span style="color: #D4D2C8"> names))</span>
<span style="color: #D4D2C8">          (persp-savelist-to-file filtered-savelist fname))))</span>
<span style="color: #D4D2C8">  )</span>

<span style="color: #7E8AA1">;; enable persp-mode-project-bridge mode</span>

<span style="color: #7E8AA1">;; (when nil</span>
<span style="color: #7E8AA1">;;   (with-eval-after-load &quot;persp-mode&quot;</span>
<span style="color: #7E8AA1">;;     (defvar persp-mode-projectile-bridge-before-switch-selected-window-buffer nil)</span>

<span style="color: #7E8AA1">;;     ;; (setq persp-add-buffer-on-find-file &#39;if-not-autopersp)</span>

<span style="color: #7E8AA1">;;     (persp-def-auto-persp</span>
<span style="color: #7E8AA1">;;      &quot;projectile&quot;</span>
<span style="color: #7E8AA1">;;      :parameters &#39;((dont-save-to-file . t)</span>
<span style="color: #7E8AA1">;;                    (persp-mode-projectile-bridge . t))</span>
<span style="color: #7E8AA1">;;      :hooks &#39;(projectile-before-switch-project-hook</span>
<span style="color: #7E8AA1">;;               projectile-after-switch-project-hook</span>
<span style="color: #7E8AA1">;;               projectile-find-file-hook</span>
<span style="color: #7E8AA1">;;               find-file-hook)</span>
<span style="color: #7E8AA1">;;      :dyn-env &#39;((after-switch-to-buffer-adv-suspend t))</span>
<span style="color: #7E8AA1">;;      :switch &#39;frame</span>
<span style="color: #7E8AA1">;;      :predicate</span>
<span style="color: #7E8AA1">;;      #&#39;(lambda (buffer &amp;optional state)</span>
<span style="color: #7E8AA1">;;          (if (eq &#39;projectile-before-switch-project-hook</span>
<span style="color: #7E8AA1">;;                  (alist-get &#39;hook state))</span>
<span style="color: #7E8AA1">;;              state</span>
<span style="color: #7E8AA1">;;            (and</span>
<span style="color: #7E8AA1">;;             projectile-mode</span>
<span style="color: #7E8AA1">;;             (buffer-live-p buffer)</span>
<span style="color: #7E8AA1">;;             (buffer-file-name buffer)</span>
<span style="color: #7E8AA1">;;             ;; (not git-commit-mode)</span>
<span style="color: #7E8AA1">;;             (projectile-project-p)</span>
<span style="color: #7E8AA1">;;             (or state t))))</span>
<span style="color: #7E8AA1">;;      :get-name</span>
<span style="color: #7E8AA1">;;      #&#39;(lambda (state)</span>
<span style="color: #7E8AA1">;;          (if (eq &#39;projectile-before-switch-project-hook</span>
<span style="color: #7E8AA1">;;                  (alist-get &#39;hook state))</span>
<span style="color: #7E8AA1">;;              state</span>
<span style="color: #7E8AA1">;;            (push (cons &#39;persp-name</span>
<span style="color: #7E8AA1">;;                        (concat &quot;[p] &quot;</span>
<span style="color: #7E8AA1">;;                                (with-current-buffer (alist-get &#39;buffer state)</span>
<span style="color: #7E8AA1">;;                                  (projectile-project-name))))</span>
<span style="color: #7E8AA1">;;                  state)</span>
<span style="color: #7E8AA1">;;            state))</span>
<span style="color: #7E8AA1">;;      :on-match</span>
<span style="color: #7E8AA1">;;      #&#39;(lambda (state)</span>
<span style="color: #7E8AA1">;;          (let ((hook (alist-get &#39;hook state))</span>
<span style="color: #7E8AA1">;;                (persp (alist-get &#39;persp state))</span>
<span style="color: #7E8AA1">;;                (buffer (alist-get &#39;buffer state)))</span>
<span style="color: #7E8AA1">;;            (pcase hook</span>
<span style="color: #7E8AA1">;;              (projectile-before-switch-project-hook</span>
<span style="color: #7E8AA1">;;               (let ((win (if (minibuffer-window-active-p (selected-window))</span>
<span style="color: #7E8AA1">;;                              (minibuffer-selected-window)</span>
<span style="color: #7E8AA1">;;                            (selected-window))))</span>
<span style="color: #7E8AA1">;;                 (when (window-live-p win)</span>
<span style="color: #7E8AA1">;;                   (setq persp-mode-projectile-bridge-before-switch-selected-window-buffer</span>
<span style="color: #7E8AA1">;;                         (window-buffer win)))))</span>

<span style="color: #7E8AA1">;;              (projectile-after-switch-project-hook</span>
<span style="color: #7E8AA1">;;               (when (buffer-live-p</span>
<span style="color: #7E8AA1">;;                      persp-mode-projectile-bridge-before-switch-selected-window-buffer)</span>
<span style="color: #7E8AA1">;;                 (let ((win (selected-window)))</span>
<span style="color: #7E8AA1">;;                   (unless (eq (window-buffer win)</span>
<span style="color: #7E8AA1">;;                               persp-mode-projectile-bridge-before-switch-selected-window-buffer)</span>
<span style="color: #7E8AA1">;;                     (set-window-buffer</span>
<span style="color: #7E8AA1">;;                      win persp-mode-projectile-bridge-before-switch-selected-window-buffer)))))</span>

<span style="color: #7E8AA1">;;              (find-file-hook</span>
<span style="color: #7E8AA1">;;               (setcdr (assq :switch state) nil)))</span>
<span style="color: #7E8AA1">;;            (if (pcase hook</span>
<span style="color: #7E8AA1">;;                  (projectile-before-switch-project-hook nil)</span>
<span style="color: #7E8AA1">;;                  (t t))</span>
<span style="color: #7E8AA1">;;                (persp--auto-persp-default-on-match state)</span>
<span style="color: #7E8AA1">;;              (setcdr (assq :after-match state) nil)))</span>
<span style="color: #7E8AA1">;;          state)</span>
<span style="color: #7E8AA1">;;      :after-match</span>
<span style="color: #7E8AA1">;;      #&#39;(lambda (state)</span>
<span style="color: #7E8AA1">;;          (when (eq &#39;find-file-hook (alist-get &#39;hook state))</span>
<span style="color: #7E8AA1">;;            (run-at-time 0.5 nil</span>
<span style="color: #7E8AA1">;;                         #&#39;(lambda (buf persp)</span>
<span style="color: #7E8AA1">;;                             (when (and (eq persp (get-current-persp))</span>
<span style="color: #7E8AA1">;;                                        (not (eq buf (window-buffer (selected-window)))))</span>
<span style="color: #7E8AA1">;;                               ;; (switch-to-buffer buf)</span>
<span style="color: #7E8AA1">;;                               (persp-add-buffer buf persp t nil)))</span>
<span style="color: #7E8AA1">;;                         (alist-get &#39;buffer state)</span>
<span style="color: #7E8AA1">;;                         (get-current-persp)))</span>
<span style="color: #7E8AA1">;;          (persp--auto-persp-default-after-match state)))</span>

<span style="color: #7E8AA1">;;     ;; (add-hook &#39;persp-after-load-state-functions</span>
<span style="color: #7E8AA1">;;     ;;           #&#39;(lambda (&amp;rest args) (persp-auto-persps-pickup-buffers)) t)</span>
<span style="color: #7E8AA1">;;     ))</span>

<span style="color: #7E8AA1">;; Shows groups for all perspectives. But can&#39;t show same buffer in multiple groups.</span>

<span style="color: #7E8AA1">;; (with-eval-after-load &quot;ibuffer&quot;</span>

<span style="color: #7E8AA1">;;   (require &#39;ibuf-ext)</span>

<span style="color: #7E8AA1">;;   (define-ibuffer-filter persp</span>
<span style="color: #7E8AA1">;;       &quot;Toggle current view to buffers of current perspective.&quot;</span>
<span style="color: #7E8AA1">;;     (:description &quot;persp-mode&quot;</span>
<span style="color: #7E8AA1">;;                   :reader (persp-prompt nil nil (safe-persp-name (get-frame-persp)) t))</span>
<span style="color: #7E8AA1">;;     (find buf (safe-persp-buffers (persp-get-by-name qualifier))))</span>

<span style="color: #7E8AA1">;;   (defun persp-add-ibuffer-group ()</span>
<span style="color: #7E8AA1">;;     (let ((perspslist (mapcar #&#39;(lambda (pn)</span>
<span style="color: #7E8AA1">;;                                   (list pn (cons &#39;persp pn)))</span>
<span style="color: #7E8AA1">;;                               (nconc</span>
<span style="color: #7E8AA1">;;                                (cl-delete persp-nil-name</span>
<span style="color: #7E8AA1">;;                                           (persp-names-current-frame-fast-ordered)</span>
<span style="color: #7E8AA1">;;                                           :test &#39;string=)</span>
<span style="color: #7E8AA1">;;                                (list persp-nil-name)))))</span>
<span style="color: #7E8AA1">;;       (setq ibuffer-saved-filter-groups</span>
<span style="color: #7E8AA1">;;             (cl-delete &quot;persp-mode&quot; ibuffer-saved-filter-groups</span>
<span style="color: #7E8AA1">;;                        :test &#39;string= :key &#39;car))</span>
<span style="color: #7E8AA1">;;       (push</span>
<span style="color: #7E8AA1">;;        (cons &quot;persp-mode&quot; perspslist)</span>
<span style="color: #7E8AA1">;;        ibuffer-saved-filter-groups)))</span>

<span style="color: #7E8AA1">;;   (defun persp-ibuffer-visit-buffer ()</span>
<span style="color: #7E8AA1">;;     (interactive)</span>
<span style="color: #7E8AA1">;;     (let ((buf (ibuffer-current-buffer t))</span>
<span style="color: #7E8AA1">;;           (persp-name (get-text-property</span>
<span style="color: #7E8AA1">;;                        (line-beginning-position) &#39;ibuffer-filter-group)))</span>
<span style="color: #7E8AA1">;;       (persp-switch persp-name)</span>
<span style="color: #7E8AA1">;;       (switch-to-buffer buf)))</span>

<span style="color: #7E8AA1">;;   (define-key ibuffer-mode-map (kbd &quot;RET&quot;) &#39;persp-ibuffer-visit-buffer)</span>

<span style="color: #7E8AA1">;;   (add-hook &#39;ibuffer-mode-hook</span>
<span style="color: #7E8AA1">;;             #&#39;(lambda ()</span>
<span style="color: #7E8AA1">;;                 (persp-add-ibuffer-group)</span>
<span style="color: #7E8AA1">;;                 (ibuffer-switch-to-saved-filter-groups &quot;persp-mode&quot;))))</span>
</code></pre></div>
<h3 id="perspective">% Perspective</h3>
<div class="highlight" style="background: #1d2331"><pre style="line-height: 125%;"><span></span><code><span style="color: #D4D2C8">(leaf perspective </span><span style="color: #FFD173">:disabled</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">t</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:init</span>
<span style="color: #D4D2C8">  (persp-mode)</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:custom</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFAD66">`</span><span style="color: #D4D2C8">(persp-mode-prefix-key </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">,</span><span style="color: #D4D2C8">(kbd </span><span style="color: #D5FF80">&quot;C-c .&quot;</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:bind</span>
<span style="color: #D4D2C8">  (</span><span style="color: #D5FF80">&quot;C-c .&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> perspective-map)</span>
<span style="color: #D4D2C8">  (perspective-map</span>
<span style="color: #D4D2C8">   (</span><span style="color: #D5FF80">&quot;S&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> persp-state-save)</span>
<span style="color: #D4D2C8">   (</span><span style="color: #D5FF80">&quot;M-s&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> persp-state-save)</span>
<span style="color: #D4D2C8">   (</span><span style="color: #D5FF80">&quot;C-s&quot;</span><span style="color: #D4D2C8"> </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:hook</span>
<span style="color: #D4D2C8">  (kill-emacs-hook </span><span style="color: #FFAD66">.</span><span style="color: #D4D2C8"> persp-state-save)</span>
<span style="color: #D4D2C8">  </span><span style="color: #FFD173">:config</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; default backup file</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFAD66">setq</span><span style="color: #D4D2C8"> persp-state-default-file</span>
<span style="color: #D4D2C8">        (file-name-concat persp-save-dir </span><span style="color: #D5FF80">&quot;persp-auto-save&quot;</span><span style="color: #D4D2C8">))</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; prev/next buffers</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFAD66">setq</span><span style="color: #D4D2C8"> switch-to-prev-buffer-skip</span>
<span style="color: #D4D2C8">        (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (win buff bury-or-kill)</span>
<span style="color: #D4D2C8">          (not (persp-is-current-buffer buff))))</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; consult-buffer</span>
<span style="color: #D4D2C8">  (</span><span style="color: #FFD173">with-eval-after-load</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;consult</span>
<span style="color: #D4D2C8">    (consult-customize consult--source-buffer </span><span style="color: #FFD173">:hidden</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">:default</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">nil</span><span style="color: #D4D2C8">)</span>
<span style="color: #D4D2C8">    (add-to-list </span><span style="color: #DFBFFF">&#39;consult-buffer-sources</span><span style="color: #D4D2C8"> persp-consult-source))</span>

<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; save activities before deleting frame</span>
<span style="color: #D4D2C8">  (add-to-list </span><span style="color: #DFBFFF">&#39;delete-frame-functions</span>
<span style="color: #D4D2C8">               (</span><span style="color: #FFD173">lambda</span><span style="color: #D4D2C8"> (frame)</span>
<span style="color: #D4D2C8">                 (persp-save-state)))</span>
<span style="color: #D4D2C8">  </span><span style="color: #7E8AA1">;; save activities before killing emacs</span>
<span style="color: #D4D2C8">  (add-hook </span><span style="color: #DFBFFF">&#39;kill-emacs-hook</span><span style="color: #D4D2C8"> </span><span style="color: #FFD173">#&#39;</span><span style="color: #D4D2C8">persp-save-state)</span>
<span style="color: #D4D2C8">  )</span>

<span style="color: #D4D2C8">(</span><span style="color: #FFD173">provide</span><span style="color: #D4D2C8"> </span><span style="color: #DFBFFF">&#39;+workspaces</span><span style="color: #D4D2C8">)</span>
</code></pre></div>
<hr />
<p><em>Last updated: August 22, 2025</em></p>
</section>

<section id="mkdocs-terminal-after-content">
    
</section>

            </main>
        </div>
        <hr><footer>
    <div class="terminal-mkdocs-footer-grid">
        <div id="terminal-mkdocs-footer-copyright-info">
             Site built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/ntno/mkdocs-terminal">Terminal for MkDocs</a>.
        </div>
    </div>
</footer>
    </div>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="alertdialog" aria-modal="true" aria-labelledby="searchModalLabel">
    <div class="modal-dialog modal-lg" role="search">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search</h5>
                <button type="button" class="close btn btn-default btn-ghost" data-dismiss="modal"><span aria-hidden="true">x</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p id="searchInputLabel">Type to start searching</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" aria-labelledby="searchInputLabel" placeholder="" id="mkdocs-search-query" title="Please enter search terms here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No document matches found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    
    
</body>

</html>